# Skill: Exploit Development

> Turning vulnerabilities into working exploits for proof-of-concept and defense improvement, derived from Project Zero methodology.

## When to Use

- Proving exploitability of a vulnerability
- Assessing real-world risk of a bug
- Understanding attacker techniques
- Developing mitigations
- Security research and education

## Prerequisites

- Confirmed vulnerability
- Understanding of target architecture
- Debugging environment
- Knowledge of relevant exploit techniques
- Exploitation mitigations awareness

## Steps

### 1. Assess the Primitive
```
□ What does the vulnerability give you?
  - Memory read (arbitrary? limited?)
  - Memory write (arbitrary? limited?)
  - Control flow hijack
  - Information disclosure
  - Type confusion
  - Other primitive
□ What are the constraints?
  - Size limits
  - Character restrictions
  - Timing requirements
  - Alignment requirements
```

### 2. Define the Goal
```
□ What's the target outcome?
  - Code execution
  - Privilege escalation
  - Information disclosure
  - Sandbox escape
  - Denial of service (last resort)
□ What's the minimal PoC that proves impact?
```

### 3. Map the Environment
```
□ What mitigations are present?
  - ASLR (full? partial?)
  - Stack canaries
  - CFI (Control Flow Integrity)
  - Sandboxing
  - W^X (non-executable memory)
  - Heap hardening
□ What primitives are needed to bypass each?
```

### 4. Build Exploitation Strategy
```
COMMON PATTERNS:

Memory Corruption → RCE:
┌─────────────────────────────────────────────────────────────┐
│  1. Trigger bug → Get primitive (read/write)                │
│  2. Info leak → Defeat ASLR                                 │
│  3. Controlled write → Corrupt critical data                │
│  4. Control flow → Hijack execution                         │
│  5. Payload → Achieve goal                                  │
└─────────────────────────────────────────────────────────────┘

Type Confusion → RCE:
┌─────────────────────────────────────────────────────────────┐
│  1. Create type confusion                                   │
│  2. Exploit type mismatch for primitive                     │
│  3. Leverage primitive for code execution                   │
└─────────────────────────────────────────────────────────────┘
```

### 5. Develop Step by Step
```
□ Get reliable trigger
□ Achieve heap/memory layout control
□ Implement info leak (if needed)
□ Implement write primitive
□ Implement control flow hijack
□ Execute payload
□ Handle cleanup/stability
```

### 6. Improve Reliability
```
□ Reduce race condition windows
□ Handle different memory layouts
□ Account for version differences
□ Test across configurations
□ Measure success rate
```

### 7. Document & Minimize
```
□ Create minimal PoC (not weaponized)
□ Document each exploitation step
□ Explain why each step works
□ Note reliability constraints
□ Describe detection opportunities
```

## Exploitation Primitives Reference

| Primitive | Use | Common Sources |
|-----------|-----|----------------|
| Arbitrary Read | ASLR bypass, data leak | OOB read, format string |
| Arbitrary Write | Corrupt pointers, data | Heap overflow, UAF |
| Limited Write | Corrupt adjacent data | Stack overflow |
| Type Confusion | Fake objects, vtable | JIT bugs, casting errors |
| Use-After-Free | Dangling pointer reuse | Lifetime errors |
| Double Free | Heap corruption | Reference counting bugs |

## Mitigation Bypass Techniques

| Mitigation | Bypass Approach |
|------------|-----------------|
| ASLR | Info leak, brute force, partial overwrite |
| Stack Canary | Info leak, overwrite around canary |
| NX/W^X | ROP, JOP, JIT spray |
| CFI | Allowed target reuse, type confusion |
| Sandbox | Escape via IPC, kernel bug, broker bug |

## Examples

### Good: Staged Exploitation
```
Stage 1: Trigger heap overflow
  - Spray heap with controlled objects
  - Overflow into adjacent object
  - Corrupt length field

Stage 2: Info leak
  - Use corrupted length for OOB read
  - Leak heap pointer → heap base
  - Leak code pointer → ASLR bypass

Stage 3: Arbitrary write
  - Use corrupted object for write primitive
  - Overwrite function pointer

Stage 4: Code execution
  - Trigger call to corrupted pointer
  - Execute shellcode/ROP chain
```

### Good: Minimal PoC
```c
// PoC: Demonstrates arbitrary read primitive
// Does NOT include weaponized payload

void poc() {
    // Trigger vulnerability
    trigger_type_confusion();
    
    // Demonstrate primitive
    uint64_t leaked = arbitrary_read(TARGET_ADDR);
    printf("Leaked value: 0x%lx\n", leaked);
    
    // Proves exploitability without weaponization
}
```

## Anti-patterns

### ❌ Overcomplicating PoC
```
DON'T: Build full weaponized exploit for disclosure
WHY: Unnecessary, helps attackers more than defenders
FIX: Minimal PoC that proves impact
```

### ❌ Ignoring Reliability
```
DON'T: "It works sometimes"
WHY: Unreliable PoC is unconvincing
FIX: Understand and document reliability factors
```

### ❌ Skipping Mitigation Analysis
```
DON'T: Assume mitigations don't apply
WHY: Miss detection/defense opportunities
FIX: Document what mitigations would help
```

### ❌ Hardcoding Offsets
```
DON'T: Rely on specific version/build offsets
WHY: PoC breaks on other systems
FIX: Use info leaks, document requirements
```

### ❌ No Documentation
```
DON'T: Write exploit code without comments
WHY: Can't be understood or reproduced
FIX: Document each step and why it works
```

## Responsible Disclosure Considerations

### What to Include in Reports
```
✓ Proof that primitive is exploitable
✓ Impact assessment
✓ Mitigation bypass analysis
✓ Detection opportunities
```

### What to Withhold
```
✗ Full weaponized exploit
✗ Shellcode/payloads
✗ One-click tools
✗ Persistence mechanisms
```

## Debugging Tips

```
□ Use memory sanitizers during development
□ Attach debugger with symbols if possible
□ Add logging/assertions to track state
□ Test on debug builds first
□ Compare working vs failing attempts
```

## Metrics

- Time from bug to PoC
- Reliability percentage
- Mitigation bypass complexity
- Detection surface created

## References

- Project Zero blog (exploitation writeups)
- Phrack articles
- Conference talks (OffensiveCon, etc.)
